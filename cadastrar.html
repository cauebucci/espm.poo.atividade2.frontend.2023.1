<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Livro - Biblioteca</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>    <script type="text/javascript" src="public/lib/jquery/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="public/lib/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="public/lib/datatables.net/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="public/lib/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript" src="public/lib/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="public/lib/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script type="text/javascript" src="public/lib/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="public/lib/datatables.net-buttons/js/buttons.flash.min.js"></script>
    <script type="text/javascript" src="public/lib/datatables.net-buttons/js/buttons.print.min.js"></script>
    <link rel="stylesheet" type="text/css" href="public/lib/sweetalert2-11.4.19/css/sweetalert2.min.css" />
    <script type="text/javascript" charset="utf-8" src="public/lib/jquery-mask/jquery-mask-1.14.16.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="public/lib/sweetalert2-11.4.19/js/sweetalert2.min.js"></script>
    <script type="text/javascript" src="public/lib/datatables.net-select/js/dataTables.select.min.js"></script>
    <script type="text/javascript" src="public/js/datatables-custom.js"></script>
    <link rel="stylesheet" type="text/css" href="public/lib/datatables.net-bs4/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" type="text/css" href="public/lib/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" />
    <link rel="stylesheet" type="text/css" href="public/lib/datatables.net-select-bs4/css/select.bootstrap4.min.css" />
    <link rel="stylesheet" type="text/css" href="public/lib/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="public/css/style.css" media="screen" />
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <a class="navbar-brand" href="#">Biblioteca</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-item nav-link" href="index.html">Início</a>
            <a class="nav-item nav-link" href="livros.html">Listar Livros <span class="sr-only">(current)</span></a>
            <a class="nav-item nav-link active" href="#">Cadastrar Livro</a>
          </div>
        </div>
      </nav>
      <div class="limitador">
        <div class="card tabela-container" >
            <div style="text-align: center; padding-top: 10px;">
                <h1 style="color: #007bff;">Cadastrar</h1>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label for="titulo">Título</label>
                    <input id="titulo" name="titulo" maxlength="85" class="form-control" type="text" spellcheck="false" value=""  />
                    <p class="cadastro-error" id="error-titulo"></p>

                </div>

                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="autor">Autor</label>
                            <input id="autor" name="autor" maxlength="85" class="form-control" type="text" spellcheck="false" value=""  />
                            <p class="cadastro-error" id="error-autor"></p>

                        </div>

                    </div>
                
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="editora">Editora</label>
                            <input id="editora" name="editora" maxlength="100" class="form-control" type="text" spellcheck="false"  />
                            <p class="cadastro-error" id="error-editora"></p>

                        </div>

                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="ano">Ano</label>
                            <input id="ano" name="ano" class="form-control" type="text" spellcheck="false" value=""  />
                            <p class="cadastro-error" id="error-ano"></p>

                        </div>

                    </div>
                
                    <div class="col-sm-6">
                        <div class="form-group">
                            <label for="preco">Preço</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                  <div class="input-group-text">R$</div>
                                </div>
                                <input id="preco" name="preco" maxlength="100" class="form-control" type="text" spellcheck="false"  />
                            </div>
                            <p class="cadastro-error" id="error-preco"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div style="text-align: right; margin: 20px;">
                <button type="button" style="width: 200px;" onclick="cadastrarLivro()" class="btn btn-primary">Cadastrar</button>
            </div>
        </div>
      </div>
   
    <script type="text/javascript">
        
            $('#preco').mask("0000000000.##", {reverse: true});
            $('#ano').mask("0000", {reverse: true});

    let titulo = document.getElementById("titulo");
    let autor = document.getElementById("autor");
    let editora = document.getElementById("editora");
    let ano = document.getElementById("ano");
    let preco = document.getElementById("preco");
    
   

    async function cadastrarLivro() {
		let erros = false;
        
		if(!titulo.value){
            erros = true;
			document.getElementById("error-titulo").textContent = "(!) Este campo é obrigatório!";
        } else {
			document.getElementById("error-titulo").textContent = "";
        }

		if(!autor.value){
			erros = true;
            document.getElementById("error-autor").textContent = "(!) Este campo é obrigatório!";
        } else {
			document.getElementById("error-autor").textContent = "";
        }

		if(!editora.value){
			erros = true;
            document.getElementById("error-editora").textContent = "(!) Este campo é obrigatório!";
        } else {
			document.getElementById("error-editora").textContent = "";
        }

        if(!ano.value){
			erros = true;
            document.getElementById("error-ano").textContent = "(!) Este campo é obrigatório!";
        } else {
			document.getElementById("error-ano").textContent = "";
        }

        if(!preco.value){
			erros = true;
            document.getElementById("error-preco").textContent = "(!) Este campo é obrigatório!";
        } else {
			document.getElementById("error-preco").textContent = "";
        }

        if(erros){
            return;
        }

        let dados = {
            titulo: titulo.value,
            autor: autor.value,
            editora: editora.value,
            ano: ano.value,
            preco: preco.value
        }

        let opcoes = {
			method: "POST",
			headers: {
				"Content-Type": "application/json"
		    },
		    body: JSON.stringify(dados)
		};
        

        try{
            let response = await fetch("http://localhost:8080/livros", opcoes);

            if(response.ok){
                Swal.fire({
                icon: 'success',
                title: 'Cadastrado com sucesso!',
                text: `O livro ${titulo.value} foi cadastrado com sucesso!`
                });
                        
                titulo.value = null;
                autor.value = null;
                editora.value = null;
                ano.value = null;
                preco.value = null;
            }else{
                Swal.fire({
                icon: 'error',
                title: 'Oops..',
                text: `Deu um erro ao cadastrar o livro!`
                });
            }

        } catch(ex){
            Swal.fire({
            icon: 'error',
            title: 'Ops..',
            text: `Erro ao cadastrar! \n ERRO: ${ex.message}`
        });
        }

        


        console.log(dados);
    }
  
    </script>
</body>
</html>